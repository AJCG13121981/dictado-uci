<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dictado UCI</title>
</head>
<body style="font-family: Arial; font-size: 16px;">
  <h2>ðŸŽ¤ Dictado UCI (decir "copia" para empezar y "guarda" para enviar)</h2>
  <p id="estado">Esperando comando...</p>
  <p id="output"></p>

  <script>
    if (!('webkitSpeechRecognition' in window)) {
      alert('Este navegador no soporta reconocimiento por voz.');
    } else {
      const recognition = new webkitSpeechRecognition();
      recognition.lang = "es-ES";
      recognition.continuous = true;
      recognition.interimResults = false;

      let capturando = false;
      let textoCapturado = "";

      recognition.onresult = function(event) {
        const resultado = event.results[event.results.length - 1][0].transcript.toLowerCase();
        document.getElementById("output").innerText = "Reconocido: " + resultado;

        if (resultado.includes("copia")) {
          capturando = true;
          textoCapturado = "";
          document.getElementById("estado").innerText = "ðŸŽ¤ Grabando datos...";
          return;
        }

        if (resultado.includes("guarda")) {
          capturando = false;
          document.getElementById("estado").innerText = "ðŸ“¤ Enviando datos...";

          const presion = textoCapturado.match(/presiÃ³n\s*(\d+)/);
          const temperaturaMatch = textoCapturado.match(/temperatura\s*([\d,\.]+)/)
                                     || textoCapturado.match(/(\d{2}[,\.]\d)/);
          const temperatura = temperaturaMatch ? temperaturaMatch[1].replace(",", ".") : "";
          const saturacion = textoCapturado.match(/saturaciÃ³n\s*(\d+)/);

          const datos = {
            presion: presion ? presion[1] : "",
            temperatura: temperatura,
            saturacion: saturacion ? saturacion[1] : ""
          };

          fetch('https://script.google.com/macros/s/AKfycbxbaIQhQDbfBHKaVrCmaeTkJE190dn9hmiueJlO2XQXXpp76uCwefky6S9RG_E_ek0NCA/exec', {
            method: 'POST',
            body: JSON.stringify(datos)
          })
          .then(response => response.text())
          .then(data => {
            alert("âœ… Datos enviados:\n" +
              `PresiÃ³n: ${datos.presion}\n` +
              `Temperatura: ${datos.temperatura}\n` +
              `SaturaciÃ³n: ${datos.saturacion}`);
            document.getElementById("estado").innerText = "âœ… Datos guardados.";
          })
          .catch(error => {
            alert("Error al enviar: " + error);
          });

          return;
        }

        if (capturando) {
          textoCapturado += " " + resultado;
        }
      };

      recognition.onerror = function(event) {
        alert("Error: " + event.error);
      };

      recognition.start();
    }
  </script>
</body>
</html>



