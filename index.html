<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dictado UCI</title>
</head>
<body style="font-family: Arial; font-size: 16px;">
  <h2>🎤 Dictado UCI</h2>
  <button onclick="startDictation()">Empezar dictado</button>
  <p id="output">Esperando dictado...</p>

  <script>
    function startDictation() {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Este navegador no soporta reconocimiento por voz.');
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = "es-ES";
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onresult = function(event) {
        const resultado = event.results[0][0].transcript.toLowerCase();
        document.getElementById("output").innerText = "Reconocido: " + resultado;

        const presion = resultado.match(/presión\s*(\d+)/);
        const temperatura = resultado.match(/temperatura\s*([\d,\.]+)/);
        const saturacion = resultado.match(/saturación\s*(\d+)/);

        const datos = {
          presion: presion ? presion[1] : "",
          temperatura: temperatura ? temperatura[1].replace(",", ".") : "",
          saturacion: saturacion ? saturacion[1] : ""
        };

        if (!datos.presion && !datos.temperatura && !datos.saturacion) {
          alert("No se detectaron datos válidos.");
          return;
        }

        fetch('https://script.google.com/macros/s/AKfycbxbaIQhQDbfBHKaVrCmaeTkJE190dn9hmiueJlO2XQXXpp76uCwefky6S9RG_E_ek0NCA/exec', {
          method: 'POST',
          body: JSON.stringify(datos)
        })
        .then(response => response.text())
        .then(data => {
          alert("Datos enviados correctamente:\n" +
                `Presión: ${datos.presion}\n` +
                `Temperatura: ${datos.temperatura}\n` +
                `Saturación: ${datos.saturacion}`);
        })
        .catch(error => {
          alert("Error al enviar: " + error);
        });
      };

      recognition.onerror = function(event) {
        alert("Error: " + event.error);
      };

      recognition.start();
    }
  </script>
</body>
</html>

