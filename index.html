<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dictado UCI</title>
</head>
<body>
  <h1>Dictado UCI</h1>
  <button id="recordButton" style="font-size: 2em; padding: 20px;">ðŸŽ¤ Empezar dictado</button>

  <script>
    const recordButton = document.getElementById("recordButton");

    let recognition;
    let transcriptFinal = "";
    let grabando = false;

    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.lang = 'es-ES';
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onresult = function(event) {
        transcriptFinal = event.results[0][0].transcript;
        procesarDatos(transcriptFinal);
      };

      recognition.onerror = function(event) {
        alert('Error en el reconocimiento de voz: ' + event.error);
      };

      recognition.onend = function() {
        grabando = false;
        recordButton.textContent = "ðŸŽ¤ Empezar dictado";
      };
    } else {
      alert("Este navegador no admite reconocimiento de voz.");
    }

    recordButton.addEventListener("click", () => {
      if (grabando) {
        recognition.stop();
      } else {
        transcriptFinal = "";
        recognition.start();
        grabando = true;
        recordButton.textContent = "â¹ Detener dictado";
      }
    });

    function procesarDatos(texto) {
      const presion = texto.match(/presi[oÃ³]n (\d+)/i)?.[1] || "";
      const temperatura = texto.match(/temperatura (\d+(?:[,.]\d+)?)/i)?.[1].replace(",", ".") || "";
      const saturacion = texto.match(/saturaci[oÃ³]n (\d+)/i)?.[1] || "";

      if (!presion && !temperatura && !saturacion) {
        alert("No se detectaron datos vÃ¡lidos.");
        return;
      }

      const datos = {
        presion,
        temperatura,
        saturacion
      };

      fetch("https://script.google.com/macros/s/AKfycbySLfZTDe0sz0RSDdZQcwnmxsAy1eZfJO7NaaKbwzQah0a2XZbfGa_-nehFNtM7zKwckg/exec", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(datos)
      })
      .then(response => response.text())
      .then(text => {
        alert("Enviado correctamente:\n" + text);
      })
      .catch(err => {
        alert("Error real al enviar los datos: " + err);
      });
    }
  </script>
</body>
</html>






