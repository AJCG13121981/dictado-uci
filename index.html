<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dictado UCI</title>
</head>
<body>
  <h1>Dictado UCI</h1>
  <button id="recordButton" style="font-size: 2em; padding: 20px;"> Mantener para grabar</button>

  <script>
    const recordButton = document.getElementById("recordButton");

    let recognition;
    let transcriptFinal = "";

    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.lang = 'es-ES';
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onresult = function(event) {
        transcriptFinal = event.results[0][0].transcript;
        procesarDatos(transcriptFinal);
      };

      recognition.onerror = function(event) {
        alert('Error en el reconocimiento de voz: ' + event.error);
      };

      recognition.onend = function() {
        console.log("Grabaci贸n finalizada");
      };
    } else {
      alert("Este navegador no admite reconocimiento de voz.");
    }

    recordButton.addEventListener("mousedown", () => {
      transcriptFinal = "";
      if (recognition) recognition.start();
    });

    recordButton.addEventListener("mouseup", () => {
      if (recognition) recognition.stop();
    });

    function procesarDatos(texto) {
      // Buscar los datos num茅ricos con expresiones regulares
      const presion = texto.match(/presi[o贸]n (\d+)/i)?.[1] || "";
      const temperatura = texto.match(/temperatura (\d+(?:[,.]\d+)?)/i)?.[1].replace(",", ".") || "";
      const saturacion = texto.match(/saturaci[o贸]n (\d+)/i)?.[1] || "";

      if (!presion && !temperatura && !saturacion) {
        alert("No se detectaron datos v谩lidos.");
        return;
      }

      const datos = {
        presion,
        temperatura,
        saturacion
      };

      fetch("https://script.google.com/macros/s/AKfycbySLfZTDe0sz0RSDdZQcwnmxsAy1eZfJO7NaaKbwzQah0a2XZbfGa_-nehFNtM7zKwckg/exec", {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(datos)
      })
      .then(() => {
        alert("Datos enviados correctamente:\n" +
              `Presi贸n: ${presion}\nTemperatura: ${temperatura}\nSaturaci贸n: ${saturacion}`);
      })
      .catch(err => {
        alert("Error al enviar los datos: " + err);
      });
    }
  </script>
</body>
</html>





